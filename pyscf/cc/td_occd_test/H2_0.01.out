#INFO: **** input file is /home/rppeng/test/td-occd/run_test/free.py ****
from pyscf import gto, scf, fci, cc, lib
from pyscf.cc import td_fci, td_occd_slow
import numpy as np
import math
einsum = lib.einsum
np.set_printoptions(precision=4,suppress=True)

mol = gto.Mole()
mol.atom = [['H', (0,0,0)], 
            ['H', (1,0,0)]] 
#mol.basis = 'sto-3g'
mol.basis = '6-31g'
mol.symmetry = False
mol.verbose = 4
mol.build()
nao = mol.nao_nr()

mf = scf.RHF(mol)
mf.kernel()

w = 0.0
f0 = np.zeros(3)
td = 0.0
tf = 1.0
step = 0.01

# initial state as the HF Slater determinant
N = fci.cistring.num_strings(nao, mol.nelec[0])
ci = np.zeros((N,N))
ci[0,0] = 1.0
print('\n#################### FCI propagation ################')
td_fci.kernel_rt_test(mf, ci, w, f0, td, tf, step, RK=4)

no = sum(mol.nelec)
nv = nao*2 - no
t = np.zeros((nv,nv,no,no))
l = np.zeros((no,no,nv,nv))
U = np.eye(nao*2)
print('\n#################### OCCD propagation ################')
td_occd_slow.kernel_rt_test(mf, t, l, U, w, f0, td, tf, step, RK=4, orb=True)
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='pauling050', release='3.10.0-327.36.3.el7.x86_64', version='#1 SMP Thu Oct 20 04:56:07 EDT 2016', machine='x86_64', processor='x86_64')  Threads 36
Python 3.7.4 (default, Aug 13 2019, 20:35:49) 
[GCC 7.3.0]
numpy 1.17.2  scipy 1.3.1
Date: Thu Sep  3 23:14:58 2020
PySCF version 1.7.1
PySCF path  /home/rppeng/code/pyscf/pyscf
GIT ORIG_HEAD 9324f3c4142ae713c70551f86b756a0d71fbddfd
GIT HEAD      ref: refs/heads/td-occd
GIT td-occd branch  7dd01cd0bf1e4f45ac0aa365c2721f1f2b737499

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 2
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 H      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr
[INPUT]  2 H      1.000000000000   0.000000000000   0.000000000000 AA    1.889726124565   0.000000000000   0.000000000000 Bohr

nuclear repulsion = 0.52917721092
number of shells = 4
number of NR pGTOs = 8
number of NR cGTOs = 4
basis = 6-31g
ecp = {}
CPU time:         0.31


******** <class 'pyscf.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/rppeng/test/td-occd/run_test/tmp8gvjank4
max_memory 4000 MB (current use 59 MB)
Set gradient conv threshold to 3.16228e-05
init E= -0.752131732969514
  HOMO = -0.442149939400371  LUMO = 0.113042775846349
cycle= 1 E= -1.09454654312156  delta_E= -0.342  |g|= 0.0252  |ddm|= 0.61
  HOMO = -0.530315478059845  LUMO = 0.165079009677014
cycle= 2 E= -1.09480176234734  delta_E= -0.000255  |g|= 0.00388  |ddm|= 0.0243
  HOMO = -0.52754989443372  LUMO = 0.167707103211189
cycle= 3 E= -1.09480796286031  delta_E= -6.2e-06  |g|= 6.99e-07  |ddm|= 0.00442
  HOMO = -0.527546418217429  LUMO = 0.167707118920962
cycle= 4 E= -1.09480796286048  delta_E= -1.67e-13  |g|= 2.88e-07  |ddm|= 4.7e-07
  HOMO = -0.527544018631637  LUMO = 0.167707099907541
Extra cycle  E= -1.09480796286051  delta_E= -3.38e-14  |g|= 4.43e-08  |ddm|= 2.78e-07
converged SCF energy = -1.09480796286051

#################### FCI propagation ################
check initial energy: -1.0948079628605112
time: 0.0000, EE(mH): 0.0
time: 0.0100, EE(mH): 9.769962616701378e-12
time: 0.0200, EE(mH): 1.687538997430238e-11
time: 0.0300, EE(mH): 2.6201263381153694e-11
time: 0.0400, EE(mH): 3.397282455352979e-11
time: 0.0500, EE(mH): 4.39648317751562e-11
time: 0.0600, EE(mH): 5.218048215738236e-11
time: 0.0700, EE(mH): 6.061817714453355e-11
time: 0.0800, EE(mH): 6.927791673660977e-11
time: 0.0900, EE(mH): 7.838174553853605e-11
time: 0.1000, EE(mH): 8.659739592076221e-11
time: 0.1100, EE(mH): 9.636735853746359e-11
time: 0.1200, EE(mH): 1.0458300891968975e-10
time: 0.1300, EE(mH): 1.127986593019159e-10
time: 0.1400, EE(mH): 1.2301271112846734e-10
time: 0.1500, EE(mH): 1.3145040611561853e-10
time: 0.1600, EE(mH): 1.3855583347321954e-10
time: 0.1700, EE(mH): 1.4854784069484595e-10
time: 0.1800, EE(mH): 1.567634910770721e-10
time: 0.1900, EE(mH): 1.6697754290362354e-10
time: 0.2000, EE(mH): 1.7430501486614958e-10
time: 0.2100, EE(mH): 1.8274270985330077e-10
time: 0.2200, EE(mH): 1.9184653865522705e-10
time: 0.2300, EE(mH): 2.007283228522283e-10
time: 0.2400, EE(mH): 2.0827783941967937e-10
time: 0.2500, EE(mH): 2.1782575743145571e-10
time: 0.2600, EE(mH): 2.2715163083830703e-10
time: 0.2700, EE(mH): 2.3581137043038325e-10
time: 0.2800, EE(mH): 2.433608869978343e-10
time: 0.2900, EE(mH): 2.531308496145357e-10
time: 0.3000, EE(mH): 2.6201263381153694e-10
time: 0.3100, EE(mH): 2.7045032879868813e-10
time: 0.3200, EE(mH): 2.7911006839076435e-10
time: 0.3300, EE(mH): 2.8821389719269064e-10
time: 0.3400, EE(mH): 2.9620750296999176e-10
time: 0.3500, EE(mH): 3.055333763768431e-10
time: 0.3600, EE(mH): 3.1530333899354446e-10
time: 0.3700, EE(mH): 3.2240876635114546e-10
time: 0.3800, EE(mH): 3.3306690738754696e-10
time: 0.3900, EE(mH): 3.390621117205228e-10
time: 0.4000, EE(mH): 3.488320743372242e-10
time: 0.4100, EE(mH): 3.5837999234900053e-10
time: 0.4200, EE(mH): 3.6548541970660153e-10
time: 0.4300, EE(mH): 3.739231146937527e-10
time: 0.4400, EE(mH): 3.836930773104541e-10
time: 0.4500, EE(mH): 3.927969061123804e-10
time: 0.4600, EE(mH): 4.005684672847565e-10
time: 0.4700, EE(mH): 4.1033842990145786e-10
time: 0.4800, EE(mH): 4.192202140984591e-10
time: 0.4900, EE(mH): 4.276579090856103e-10
time: 0.5000, EE(mH): 4.360956040727615e-10
time: 0.5100, EE(mH): 4.46753745109163e-10
time: 0.5200, EE(mH): 4.5297099404706387e-10
time: 0.5300, EE(mH): 4.631850458736153e-10
time: 0.5400, EE(mH): 4.711786516509164e-10
time: 0.5500, EE(mH): 4.805045250577678e-10
time: 0.5600, EE(mH): 4.889422200449189e-10
time: 0.5700, EE(mH): 4.982680934517703e-10
time: 0.5800, EE(mH): 5.069278330438465e-10
time: 0.5900, EE(mH): 5.144773496112975e-10
time: 0.6000, EE(mH): 5.238032230181489e-10
time: 0.6100, EE(mH): 5.324629626102251e-10
time: 0.6200, EE(mH): 5.404565683875262e-10
time: 0.6300, EE(mH): 5.488942633746774e-10
time: 0.6400, EE(mH): 5.586642259913788e-10
time: 0.6500, EE(mH): 5.67323965583455e-10
time: 0.6600, EE(mH): 5.755396159656812e-10
time: 0.6700, EE(mH): 5.835332217429823e-10
time: 0.6800, EE(mH): 5.928590951498336e-10
time: 0.6900, EE(mH): 6.008527009271347e-10
time: 0.7000, EE(mH): 6.117328865684613e-10
time: 0.7100, EE(mH): 6.197264923457624e-10
time: 0.7200, EE(mH): 6.292744103575387e-10
time: 0.7300, EE(mH): 6.368239269249898e-10
time: 0.7400, EE(mH): 6.45039577307216e-10
time: 0.7500, EE(mH): 6.550315845288424e-10
time: 0.7600, EE(mH): 6.630251903061435e-10
time: 0.7700, EE(mH): 6.714628852932947e-10
time: 0.7800, EE(mH): 6.803446694902959e-10
time: 0.7900, EE(mH): 6.883382752675971e-10
time: 0.8000, EE(mH): 6.978861932793734e-10
time: 0.8100, EE(mH): 7.052136652418994e-10
time: 0.8200, EE(mH): 7.16315895488151e-10
time: 0.8300, EE(mH): 7.251976796851523e-10
time: 0.8400, EE(mH): 7.318590178329032e-10
time: 0.8500, EE(mH): 7.411848912397545e-10
time: 0.8600, EE(mH): 7.500666754367558e-10
time: 0.8700, EE(mH): 7.58948459633757e-10
time: 0.8800, EE(mH): 7.673861546209082e-10
time: 0.8900, EE(mH): 7.753797603982093e-10
time: 0.9000, EE(mH): 7.855938122247608e-10
time: 0.9100, EE(mH): 7.929212841872868e-10
time: 0.9200, EE(mH): 8.024692021990631e-10
time: 0.9300, EE(mH): 8.122391648157645e-10
time: 0.9400, EE(mH): 8.189005029635155e-10
time: 0.9500, EE(mH): 8.286704655802168e-10
time: 0.9600, EE(mH): 8.384404281969182e-10
time: 0.9700, EE(mH): 8.468781231840694e-10
time: 0.9800, EE(mH): 8.548717289613705e-10
time: 0.9900, EE(mH): 8.635314685534468e-10
time: 1.0000, EE(mH): 8.72413252750448e-10
trace error:  [0. 0.]
Ehrenfest error:  [0. 0.]
imaginary part of energy:  3.6670761859584485e-17

#################### OCCD propagation ################
check initial energy: -1.0948079628605112
time: 0.0000, EE(mH): 0.0, X: 4.4342596094981714e-08
time: 0.0100, EE(mH): -2.717825964282383e-10, X: 0.0005330118517327281
time: 0.0200, EE(mH): 8.042100319016754e-08, X: 0.0010660893350206493
time: 0.0300, EE(mH): 3.0583047205823277e-07, X: 0.0015992808758099315
time: 0.0400, EE(mH): 7.396954160299174e-07, X: 0.0021326349176467234
time: 0.0500, EE(mH): 1.4457282038193853e-06, X: 0.002666199511027064
time: 0.0600, EE(mH): 2.4876043447363827e-06, X: 0.0032000221674531463
time: 0.0700, EE(mH): 3.928952718723622e-06, X: 0.0037341497147625195
time: 0.0800, EE(mH): 5.833344474126534e-06, X: 0.004268628153770168
time: 0.0900, EE(mH): 8.264284367953678e-06, X: 0.004803502516465003
time: 0.1000, EE(mH): 1.1285195888888211e-05, X: 0.0053388167260174585
time: 0.1100, EE(mH): 1.4959419036841837e-05, X: 0.005874613458854896
time: 0.1200, EE(mH): 1.9350187674405106e-05, X: 0.006410934009054688
time: 0.1300, EE(mH): 2.4520632191382674e-05, X: 0.006947818155300055
time: 0.1400, EE(mH): 3.053375774442202e-05, X: 0.007485304030636072
time: 0.1500, EE(mH): 3.74524380397645e-05, X: 0.00802342799525498
time: 0.1600, EE(mH): 4.533940600737196e-05, X: 0.008562224512533394
time: 0.1700, EE(mH): 5.4257237369625955e-05, X: 0.009101726028533253
time: 0.1800, EE(mH): 6.426834575634643e-05, X: 0.00964196285517017
time: 0.1900, EE(mH): 7.543496405304495e-05, X: 0.010182963057243758
time: 0.2000, EE(mH): 8.781913507505124e-05, X: 0.010724752343514075
time: 0.2100, EE(mH): 0.00010148270579435348, X: 0.011267353961996825
time: 0.2200, EE(mH): 0.00011648730868785151, X: 0.011810788599644137
time: 0.2300, EE(mH): 0.00013289434530605604, X: 0.012355074286559874
time: 0.2400, EE(mH): 0.0001507649880494455, X: 0.012900226304896262
time: 0.2500, EE(mH): 0.0001701601519688012, X: 0.013446257102560205
time: 0.2600, EE(mH): 0.0001911404936549843, X: 0.013993176211852913
time: 0.2700, EE(mH): 0.000213766388146297, X: 0.01454099017315091
time: 0.2800, EE(mH): 0.0002380979267080363, X: 0.015089702463731014
time: 0.2900, EE(mH): 0.00026419489174145383, X: 0.015639313431824814
time: 0.3000, EE(mH): 0.000292116752120819, X: 0.01618982023598501
time: 0.3100, EE(mH): 0.00032192264320940467, X: 0.016741216789829445
time: 0.3200, EE(mH): 0.00035367135708952446, X: 0.01729349371222306
time: 0.3300, EE(mH): 0.00038742132324465217, X: 0.017846638282944496
time: 0.3400, EE(mH): 0.00042323059989968215, X: 0.018400634403879394
time: 0.3500, EE(mH): 0.0004611568513723796, X: 0.018955462565766096
time: 0.3600, EE(mH): 0.0005012573409679533, X: 0.01951109982051924
time: 0.3700, EE(mH): 0.0005435889089966395, X: 0.020067519759138744
time: 0.3800, EE(mH): 0.0005882079596730705, X: 0.02062469249521119
time: 0.3900, EE(mH): 0.0006351704486817766, X: 0.02118258465399764
time: 0.4000, EE(mH): 0.0006845318565318337, X: 0.02174115936709575
time: 0.4100, EE(mH): 0.0007363471865584614, X: 0.022300376272656984
time: 0.4200, EE(mH): 0.0007906709322824668, X: 0.022860191521131997
time: 0.4300, EE(mH): 0.0008475570743016192, X: 0.023420557786510462
time: 0.4400, EE(mH): 0.0009070590576421012, X: 0.023981424283014207
time: 0.4500, EE(mH): 0.0009692297719965381, X: 0.024542736787199933
time: 0.4600, EE(mH): 0.0010341215372910995, X: 0.025104437665416115
time: 0.4700, EE(mH): 0.001101786083479439, X: 0.025666465906558186
time: 0.4800, EE(mH): 0.0011722745347775287, X: 0.026228757160056675
time: 0.4900, EE(mH): 0.001245637389457599, X: 0.02679124377903302
time: 0.5000, EE(mH): 0.0013219245071915964, X: 0.027353854868544757
time: 0.5100, EE(mH): 0.0014011850784090285, X: 0.027916516338845378
time: 0.5200, EE(mH): 0.0014834676154151794, X: 0.02847915096357532
time: 0.5300, EE(mH): 0.0015688199326291397, X: 0.02904167844279509
time: 0.5400, EE(mH): 0.0016572891237132126, X: 0.029604015470771697
time: 0.5500, EE(mH): 0.001748921544475479, X: 0.03016607580841985
time: 0.5600, EE(mH): 0.001843762792663739, X: 0.030727770360300524
time: 0.5700, EE(mH): 0.0019418576853169611, X: 0.031289007256073566
time: 0.5800, EE(mH): 0.002043250251659856, X: 0.03184969193629527
time: 0.5900, EE(mH): 0.0021479836953552933, X: 0.032409727242451294
time: 0.6000, EE(mH): 0.002256100390063409, X: 0.03296901351111134
time: 0.6100, EE(mH): 0.0023676418474671834, X: 0.03352744867208517
time: 0.6200, EE(mH): 0.002482648705282031, X: 0.034084928350459946
time: 0.6300, EE(mH): 0.0026011607090481448, X: 0.03464134597239491
time: 0.6400, EE(mH): 0.002723216680156071, X: 0.035196592874540786
time: 0.6500, EE(mH): 0.002848854512738086, X: 0.035750558416955604
time: 0.6600, EE(mH): 0.002978111139029238, X: 0.036303130099380035
time: 0.6700, EE(mH): 0.0031110225202635178, X: 0.036854193680733276
time: 0.6800, EE(mH): 0.003247623615365569, X: 0.03740363330168487
time: 0.6900, EE(mH): 0.0033879483765097973, X: 0.0379513316101603
time: 0.7000, EE(mH): 0.003532029713593232, X: 0.03849716988962662
time: 0.7100, EE(mH): 0.0036798994904607696, X: 0.03904102819000787
time: 0.7200, EE(mH): 0.0038315884891559904, X: 0.0395827854610727
time: 0.7300, EE(mH): 0.003987126405036179, X: 0.04012231968813211
time: 0.7400, EE(mH): 0.004146541818572658, X: 0.040659508029886986
time: 0.7500, EE(mH): 0.004309862183582425, X: 0.04119422695825498
time: 0.7600, EE(mH): 0.00447711380013871, X: 0.04172635240000821
time: 0.7700, EE(mH): 0.004648321811018263, X: 0.0422557598800458
time: 0.7800, EE(mH): 0.004823510160623101, X: 0.04278232466612346
time: 0.7900, EE(mH): 0.005002701601419801, X: 0.04330592191486156
time: 0.8000, EE(mH): 0.005185917665295747, X: 0.043826426818843287
time: 0.8100, EE(mH): 0.005373178646017607, X: 0.04434371475461682
time: 0.8200, EE(mH): 0.00556450358235594, X: 0.044857661431411684
time: 0.8300, EE(mH): 0.005759910247427058, X: 0.04536814304037249
time: 0.8400, EE(mH): 0.005959415128486967, X: 0.045875036404115326
time: 0.8500, EE(mH): 0.00616303341471891, X: 0.046378219126403566
time: 0.8600, EE(mH): 0.006370778976139135, X: 0.04687756974174299
time: 0.8700, EE(mH): 0.006582664363596891, X: 0.047372967864691314
time: 0.8800, EE(mH): 0.006798700773913424, X: 0.047864294338668116
time: 0.8900, EE(mH): 0.0070188980574315, X: 0.048351431384063205
time: 0.9000, EE(mH): 0.007243264689815732, X: 0.04883426274542551
time: 0.9100, EE(mH): 0.007471807773606898, X: 0.04931267383752019
time: 0.9200, EE(mH): 0.0077045330160174785, X: 0.04978655189003711
time: 0.9300, EE(mH): 0.007941444719605784, X: 0.05025578609073642
time: 0.9400, EE(mH): 0.008182545781831863, X: 0.05072026772680908
time: 0.9500, EE(mH): 0.008427837674629401, X: 0.05117989032423722
time: 0.9600, EE(mH): 0.008677320438410518, X: 0.05163454978493137
time: 0.9700, EE(mH): 0.008930992682065764, X: 0.05208414452142819
time: 0.9800, EE(mH): 0.009188851561425793, X: 0.05252857558892753
time: 0.9900, EE(mH): 0.009450892786588838, X: 0.05296774681444979
time: 1.0000, EE(mH): 0.009717110608598034, X: 0.053401564922896404
trace error:  [0. 0.]
Ehrenfest error:  1.7827084555159904e-15
energy conservation error:  [0. 0.]
imaginary part of energy:  0.0
