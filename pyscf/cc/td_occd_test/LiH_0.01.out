#INFO: **** input file is /home/rppeng/test/td-occd/run_test/free.py ****
from pyscf import gto, scf, fci, cc, lib
from pyscf.cc import td_fci, td_occd_slow
import numpy as np
import math
einsum = lib.einsum
np.set_printoptions(precision=4,suppress=True)

mol = gto.Mole()
mol.atom = [['Li', (0,0,0)], 
            ['H', (1,0,0)]] 
#mol.basis = 'sto-3g'
mol.basis = '6-31g'
mol.symmetry = False
mol.verbose = 4
mol.build()
nao = mol.nao_nr()

mf = scf.RHF(mol)
mf.kernel()

w = 0.0
f0 = np.zeros(3)
td = 0.0
tf = 1.0
step = 0.01

# initial state as the HF Slater determinant
N = fci.cistring.num_strings(nao, mol.nelec[0])
ci = np.zeros((N,N))
ci[0,0] = 1.0
print('\n#################### FCI propagation ################')
td_fci.kernel_rt_test(mf, ci, w, f0, td, tf, step, RK=4)

no = sum(mol.nelec)
nv = nao*2 - no
t = np.zeros((nv,nv,no,no))
l = np.zeros((no,no,nv,nv))
U = np.eye(nao*2)
print('\n#################### OCCD propagation ################')
td_occd_slow.kernel_rt_test(mf, t, l, U, w, f0, td, tf, step, RK=4, orb=True)
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='pauling050', release='3.10.0-327.36.3.el7.x86_64', version='#1 SMP Thu Oct 20 04:56:07 EDT 2016', machine='x86_64', processor='x86_64')  Threads 36
Python 3.7.4 (default, Aug 13 2019, 20:35:49) 
[GCC 7.3.0]
numpy 1.17.2  scipy 1.3.1
Date: Thu Sep  3 23:15:31 2020
PySCF version 1.7.1
PySCF path  /home/rppeng/code/pyscf/pyscf
GIT ORIG_HEAD 9324f3c4142ae713c70551f86b756a0d71fbddfd
GIT HEAD      ref: refs/heads/td-occd
GIT td-occd branch  7dd01cd0bf1e4f45ac0aa365c2721f1f2b737499

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 4
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 Li     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr
[INPUT]  2 H      1.000000000000   0.000000000000   0.000000000000 AA    1.889726124565   0.000000000000   0.000000000000 Bohr

nuclear repulsion = 1.58753163276
number of shells = 7
number of NR pGTOs = 26
number of NR cGTOs = 11
basis = 6-31g
ecp = {}
CPU time:         0.34


******** <class 'pyscf.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/rppeng/test/td-occd/run_test/tmpc78o72x8
max_memory 4000 MB (current use 59 MB)
Set gradient conv threshold to 3.16228e-05
init E= -7.80334290718356
  HOMO = -0.321728151031657  LUMO = -0.0195953268961423
cycle= 1 E= -7.86511650863895  delta_E= -0.0618  |g|= 0.105  |ddm|= 0.904
  HOMO = -0.314385542619934  LUMO = 0.0194524047806746
cycle= 2 E= -7.87058675287271  delta_E= -0.00547  |g|= 0.0199  |ddm|= 0.278
  HOMO = -0.324487108407659  LUMO = 0.0189097189683001
cycle= 3 E= -7.87119578868087  delta_E= -0.000609  |g|= 0.0078  |ddm|= 0.0771
  HOMO = -0.321148980816396  LUMO = 0.01878243830208
cycle= 4 E= -7.87135482835058  delta_E= -0.000159  |g|= 0.000877  |ddm|= 0.0462
  HOMO = -0.321273526114505  LUMO = 0.0185563720468917
cycle= 5 E= -7.87135556843931  delta_E= -7.4e-07  |g|= 0.000107  |ddm|= 0.00674
  HOMO = -0.32127808300936  LUMO = 0.0185565138598439
cycle= 6 E= -7.87135558695579  delta_E= -1.85e-08  |g|= 2.2e-05  |ddm|= 0.000799
  HOMO = -0.321288896484229  LUMO = 0.018555151725558
cycle= 7 E= -7.87135558718365  delta_E= -2.28e-10  |g|= 1.59e-06  |ddm|= 8.04e-05
  HOMO = -0.32128848319825  LUMO = 0.0185554798030344
Extra cycle  E= -7.87135558718572  delta_E= -2.07e-12  |g|= 4.31e-07  |ddm|= 6.94e-06
converged SCF energy = -7.87135558718572

#################### FCI propagation ################
check initial energy: -7.871355587185723
time: 0.0000, EE(mH): 0.0
time: 0.0100, EE(mH): 1.1824674572835647e-07
time: 0.0200, EE(mH): 2.3652191316614335e-07
time: 0.0300, EE(mH): 3.54791751533412e-07
time: 0.0400, EE(mH): 4.731006697511475e-07
time: 0.0500, EE(mH): 5.913154410563948e-07
time: 0.0600, EE(mH): 7.0956573949843e-07
time: 0.0700, EE(mH): 8.278817631435231e-07
time: 0.0800, EE(mH): 9.46112521660325e-07
time: 0.0900, EE(mH): 1.0643876890981119e-06
time: 0.1000, EE(mH): 1.182685949174811e-06
time: 0.1100, EE(mH): 1.3009433530442038e-06
time: 0.1200, EE(mH): 1.419179440631524e-06
time: 0.1300, EE(mH): 1.5374475026419532e-06
time: 0.1400, EE(mH): 1.6557279991502583e-06
time: 0.1500, EE(mH): 1.7739640867375783e-06
time: 0.1600, EE(mH): 1.8922730049553138e-06
time: 0.1700, EE(mH): 2.010544619679422e-06
time: 0.1800, EE(mH): 2.1287913654077784e-06
time: 0.1900, EE(mH): 2.2470771909866016e-06
time: 0.2000, EE(mH): 2.3653043967897247e-06
time: 0.2100, EE(mH): 2.4836008805095844e-06
time: 0.2200, EE(mH): 2.601847626237941e-06
time: 0.2300, EE(mH): 2.7201387808872823e-06
time: 0.2400, EE(mH): 2.838367763047245e-06
time: 0.2500, EE(mH): 2.9566589176965863e-06
time: 0.2600, EE(mH): 3.0749660595574824e-06
time: 0.2700, EE(mH): 3.193203923501642e-06
time: 0.2800, EE(mH): 3.3114826436531075e-06
time: 0.2900, EE(mH): 3.4297453765930186e-06
time: 0.3000, EE(mH): 3.54797791146666e-06
time: 0.3100, EE(mH): 3.6662619606886437e-06
time: 0.3200, EE(mH): 3.7845317990559124e-06
time: 0.3300, EE(mH): 3.902773215713751e-06
time: 0.3400, EE(mH): 4.021059041292574e-06
time: 0.3500, EE(mH): 4.139328879659843e-06
time: 0.3600, EE(mH): 4.257564967247163e-06
time: 0.3700, EE(mH): 4.375852569182825e-06
time: 0.3800, EE(mH): 4.494086880413306e-06
time: 0.3900, EE(mH): 4.612390469560523e-06
time: 0.4000, EE(mH): 4.730619451720486e-06
time: 0.4100, EE(mH): 4.8489319226519e-06
time: 0.4200, EE(mH): 4.967183997450775e-06
time: 0.4300, EE(mH): 5.085450283104365e-06
time: 0.4400, EE(mH): 5.203695252475882e-06
time: 0.4500, EE(mH): 5.321943774561078e-06
time: 0.4600, EE(mH): 5.440234929210419e-06
time: 0.4700, EE(mH): 5.558554505569191e-06
time: 0.4800, EE(mH): 5.676783487729153e-06
time: 0.4900, EE(mH): 5.795026680743831e-06
time: 0.5000, EE(mH): 5.913340928032085e-06
time: 0.5100, EE(mH): 6.031573462905726e-06
time: 0.5200, EE(mH): 6.149898368335016e-06
time: 0.5300, EE(mH): 6.268102481499227e-06
time: 0.5400, EE(mH): 6.386397188862247e-06
time: 0.5500, EE(mH): 6.50462439466537e-06
time: 0.5600, EE(mH): 6.622954629165179e-06
time: 0.5700, EE(mH): 6.741190716752499e-06
time: 0.5800, EE(mH): 6.85945167333557e-06
time: 0.5900, EE(mH): 6.977709077204963e-06
time: 0.6000, EE(mH): 7.0959860209995895e-06
time: 0.6100, EE(mH): 7.21425053029634e-06
time: 0.6200, EE(mH): 7.332525697734127e-06
time: 0.6300, EE(mH): 7.450775996176162e-06
time: 0.6400, EE(mH): 7.56904938725711e-06
time: 0.6500, EE(mH): 7.687324554694897e-06
time: 0.6600, EE(mH): 7.805599722132683e-06
time: 0.6700, EE(mH): 7.923842915147361e-06
time: 0.6800, EE(mH): 8.042114529871469e-06
time: 0.6900, EE(mH): 8.160398579093453e-06
time: 0.7000, EE(mH): 8.278652430249167e-06
time: 0.7100, EE(mH): 8.396922268616436e-06
time: 0.7200, EE(mH): 8.515197436054223e-06
time: 0.7300, EE(mH): 8.633437076355222e-06
time: 0.7400, EE(mH): 8.751770863568709e-06
time: 0.7500, EE(mH): 8.869955436807686e-06
time: 0.7600, EE(mH): 8.988280342236976e-06
time: 0.7700, EE(mH): 9.106511100753778e-06
time: 0.7800, EE(mH): 9.224795149975762e-06
time: 0.7900, EE(mH): 9.343086304625103e-06
time: 0.8000, EE(mH): 9.46135969570605e-06
time: 0.8100, EE(mH): 9.579563808870262e-06
time: 0.8200, EE(mH): 9.697860292590121e-06
time: 0.8300, EE(mH): 9.816105261961638e-06
time: 0.8400, EE(mH): 9.934407074752016e-06
time: 0.8500, EE(mH): 1.0052657373194052e-05
time: 0.8600, EE(mH): 1.0170907671636087e-05
time: 0.8700, EE(mH): 1.0289220142567501e-05
time: 0.8800, EE(mH): 1.0407479322793733e-05
time: 0.8900, EE(mH): 1.0525718963094732e-05
time: 0.9000, EE(mH): 1.0643965708823089e-05
time: 0.9100, EE(mH): 1.0762262192542948e-05
time: 0.9200, EE(mH): 1.0880491174702911e-05
time: 0.9300, EE(mH): 1.0998803645634325e-05
time: 0.9400, EE(mH): 1.1117061049503718e-05
time: 0.9500, EE(mH): 1.1235302466161556e-05
time: 0.9600, EE(mH): 1.135355987003095e-05
time: 0.9700, EE(mH): 1.147185102468029e-05
time: 0.9800, EE(mH): 1.1590083559553932e-05
time: 0.9900, EE(mH): 1.1708380043273792e-05
time: 1.0000, EE(mH): 1.1826656987068418e-05
trace error:  [0. 0.]
Ehrenfest error:  [0. 0.]
imaginary part of energy:  2.672756963739174e-16

#################### OCCD propagation ################
check initial energy: -7.871355587185721
time: 0.0000, EE(mH): 0.0, X: 4.3089934632633605e-07
time: 0.0100, EE(mH): -4.440892098500626e-10, X: 0.00039172321364615336
time: 0.0200, EE(mH): 6.131450902557845e-08, X: 0.0007834938489839594
time: 0.0300, EE(mH): 2.3391599768274318e-07, X: 0.0011753116919141057
time: 0.0400, EE(mH): 5.659650526013138e-07, X: 0.001567175411736603
time: 0.0500, EE(mH): 1.1057679216719407e-06, X: 0.001959083106389771
time: 0.0600, EE(mH): 1.9014816388107647e-06, X: 0.0023510320561626968
time: 0.0700, EE(mH): 3.0009132956365647e-06, X: 0.0027430185239937766
time: 0.0800, EE(mH): 4.4515129360434e-06, X: 0.003135037575800248
time: 0.0900, EE(mH): 6.3003433581343415e-06, X: 0.00352708292036382
time: 0.1000, EE(mH): 8.593943334744836e-06, X: 0.0039191467706335475
time: 0.1100, EE(mH): 1.1378332942513225e-05, X: 0.004311219728447593
time: 0.1200, EE(mH): 1.4698931849466135e-05, X: 0.004703290694422986
time: 0.1300, EE(mH): 1.86005379987364e-05, X: 0.005095346804397387
time: 0.1400, EE(mH): 2.3127215698082182e-05, X: 0.005487373393399511
time: 0.1500, EE(mH): 2.8322341805164797e-05, X: 0.005879353987689446
time: 0.1600, EE(mH): 3.422846717171524e-05, X: 0.006271270324970902
time: 0.1700, EE(mH): 4.088733085438889e-05, X: 0.006663102402426521
time: 0.1800, EE(mH): 4.833980504770352e-05, X: 0.007054828551792661
time: 0.1900, EE(mH): 5.66258790968277e-05, X: 0.007446425540256458
time: 0.2000, EE(mH): 6.578456179795467e-05, X: 0.007837868695554221
time: 0.2100, EE(mH): 7.585395245257587e-05, X: 0.008229132053260068
time: 0.2200, EE(mH): 8.687112540428643e-05, X: 0.008620188523904528
time: 0.2300, EE(mH): 9.887217089499245e-05, X: 0.00901101007724223
time: 0.2400, EE(mH): 0.00011189213466877845, X: 0.009401567940710263
time: 0.2500, EE(mH): 0.00012596503040640528, X: 0.009791832808884092
time: 0.2600, EE(mH): 0.000141123774000107, X: 0.010181775060552132
time: 0.2700, EE(mH): 0.0001574002475024372, X: 0.01057136497989201
time: 0.2800, EE(mH): 0.00017482528313905732, X: 0.010960572978145507
time: 0.2900, EE(mH): 0.0001934285709381811, X: 0.011349369812158438
time: 0.3000, EE(mH): 0.00021323877597012597, X: 0.011737726796168316
time: 0.3100, EE(mH): 0.0002342834815038941, X: 0.012125616003300506
time: 0.3200, EE(mH): 0.0002565891907835294, X: 0.012513010453353873
time: 0.3300, EE(mH): 0.00028018137676610877, X: 0.012899884283635175
time: 0.3400, EE(mH): 0.0003050844270546804, X: 0.0132862128998225
time: 0.3500, EE(mH): 0.00033132177712502653, X: 0.01367197310410945
time: 0.3600, EE(mH): 0.0003589157717698299, X: 0.014057143198184284
time: 0.3700, EE(mH): 0.0003878878267471464, X: 0.014441703058954633
time: 0.3800, EE(mH): 0.00041825833818620595, X: 0.014825634185294388
time: 0.3900, EE(mH): 0.000450046801603321, X: 0.015208919714511259
time: 0.4000, EE(mH): 0.0004832717763747496, X: 0.015591544407644134
time: 0.4100, EE(mH): 0.0005179509408037575, X: 0.015973494603161706
time: 0.4200, EE(mH): 0.0005541011116605432, X: 0.01635475813906912
time: 0.4300, EE(mH): 0.0005917382761566614, X: 0.016735324243901322
time: 0.4400, EE(mH): 0.0006308775937213795, X: 0.017115183397524533
time: 0.4500, EE(mH): 0.0006715334794904493, X: 0.017494327163117503
time: 0.4600, EE(mH): 0.000713719655820455, X: 0.017872747992124117
time: 0.4700, EE(mH): 0.0007574490776818266, X: 0.01825043900438005
time: 0.4800, EE(mH): 0.0008027340374638925, X: 0.01862739374598528
time: 0.4900, EE(mH): 0.0008495862804380749, X: 0.01900360592783563
time: 0.5000, EE(mH): 0.000898016821793135, X: 0.019379069148028907
time: 0.5100, EE(mH): 0.0009480362095359851, X: 0.01975377660161479
time: 0.5200, EE(mH): 0.0009996544019230669, X: 0.02012772078136211
time: 0.5300, EE(mH): 0.001052880893581687, X: 0.020500893173380254
time: 0.5400, EE(mH): 0.0011077246497848137, X: 0.02087328395152171
time: 0.5500, EE(mH): 0.0011641942734286204, X: 0.02124488167454827
time: 0.5600, EE(mH): 0.0012222978682530083, X: 0.021615672990026678
time: 0.5700, EE(mH): 0.0012820432022664363, X: 0.021985642348853973
time: 0.5800, EE(mH): 0.0013434376757714972, X: 0.022354771734192605
time: 0.5900, EE(mH): 0.0014064883178122045, X: 0.022723040408423417
time: 0.6000, EE(mH): 0.0014712019282825395, X: 0.023090424681497284
time: 0.6100, EE(mH): 0.0015375848967380534, X: 0.0234568977038012
time: 0.6200, EE(mH): 0.0016056434457567548, X: 0.023822429286348847
time: 0.6300, EE(mH): 0.0016753834959359892, X: 0.024186985750751146
time: 0.6400, EE(mH): 0.0017468107156304313, X: 0.024550529811061015
time: 0.6500, EE(mH): 0.0018199305564792212, X: 0.02491302048917857
time: 0.6600, EE(mH): 0.0018947482960385287, X: 0.025274413065094772
time: 0.6700, EE(mH): 0.0019712689809381345, X: 0.025634659062819178
time: 0.6800, EE(mH): 0.0020494974339868577, X: 0.025993706272418985
time: 0.6900, EE(mH): 0.0021294383305558995, X: 0.026351498808158333
time: 0.7000, EE(mH): 0.002211096180815275, X: 0.02670797720231456
time: 0.7100, EE(mH): 0.002294475264008611, X: 0.027063078533849576
time: 0.7200, EE(mH): 0.0023795797243764127, X: 0.027416736590720348
time: 0.7300, EE(mH): 0.0024664135249707897, X: 0.027768882064269015
time: 0.7400, EE(mH): 0.002554980433444598, X: 0.028119442773792188
time: 0.7500, EE(mH): 0.0026452840469204375, X: 0.028468343919106614
time: 0.7600, EE(mH): 0.0027373278026487924, X: 0.028815508358662475
time: 0.7700, EE(mH): 0.002831114935375467, X: 0.02916085691053703
time: 0.7800, EE(mH): 0.0029266484595780184, X: 0.029504308673471168
time: 0.7900, EE(mH): 0.0030239312369673144, X: 0.029845781364959835
time: 0.8000, EE(mH): 0.0031229658929987636, X: 0.03018519167332633
time: 0.8100, EE(mH): 0.0032237548328595267, X: 0.030522455620644935
time: 0.8200, EE(mH): 0.0033263002894301508, X: 0.0308574889333675
time: 0.8300, EE(mH): 0.003430604184728736, X: 0.031190207417534557
time: 0.8400, EE(mH): 0.0035366682702431262, X: 0.03152052733550727
time: 0.8500, EE(mH): 0.0036444940132440706, X: 0.031848365781260615
time: 0.8600, EE(mH): 0.003754082619877863, X: 0.03217364105139688
time: 0.8700, EE(mH): 0.003865435049377197, X: 0.032496273009195484
time: 0.8800, EE(mH): 0.003978551985639456, X: 0.03281618343920386
time: 0.8900, EE(mH): 0.0040934337874887206, X: 0.033133296390061795
time: 0.9000, EE(mH): 0.004210080568611829, X: 0.033447538503481984
time: 0.9100, EE(mH): 0.004328492121175032, X: 0.03375883932753872
time: 0.9200, EE(mH): 0.004448667977996479, X: 0.03406713161266843
time: 0.9300, EE(mH): 0.0045706073041884565, X: 0.03437235158901928
time: 0.9400, EE(mH): 0.004694308991304297, X: 0.03467443922406482
time: 0.9500, EE(mH): 0.004819771595165889, X: 0.03497333845963331
time: 0.9600, EE(mH): 0.004946993396259813, X: 0.03526899742776506
time: 0.9700, EE(mH): 0.005075972291379571, X: 0.03556136864504996
time: 0.9800, EE(mH): 0.005206705937510492, X: 0.035850409185335136
time: 0.9900, EE(mH): 0.005339191615050254, X: 0.03613608083091422
time: 1.0000, EE(mH): 0.005473426368141077, X: 0.03641835020252229
trace error:  [0. 0.]
Ehrenfest error:  2.4336530346138767e-14
energy conservation error:  [0. 0.]
imaginary part of energy:  0.0
