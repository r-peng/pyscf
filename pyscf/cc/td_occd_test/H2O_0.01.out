#INFO: **** input file is /home/rppeng/test/td-occd/run_test/free.py ****
from pyscf import gto, scf, fci, cc, lib
from pyscf.cc import td_fci, td_occd_slow
import numpy as np
import math
einsum = lib.einsum
np.set_printoptions(precision=4,suppress=True)

mol = gto.Mole()
#mol.atom = [['Li', (0,0,0)], 
#            ['H', (1,0,0)]] 
mol.atom = [['O', (0,0,0)], 
            ['H', (1.0,0,0)],
            ['H', (math.cos(109),math.sin(109),0)]] 
#mol.basis = 'sto-3g'
mol.basis = '6-31g'
mol.symmetry = False
mol.verbose = 4
mol.build()
nao = mol.nao_nr()

mf = scf.RHF(mol)
mf.kernel()

w = 0.0
f0 = np.zeros(3)
td = 0.0
tf = 1.0
step = 0.01

# initial state as the HF Slater determinant
N = fci.cistring.num_strings(nao, mol.nelec[0])
ci = np.zeros((N,N))
ci[0,0] = 1.0
print('\n#################### FCI propagation ################')
td_fci.kernel_rt_test(mf, ci, w, f0, td, tf, step, RK=4)

no = sum(mol.nelec)
nv = nao*2 - no
t = np.zeros((nv,nv,no,no))
l = np.zeros((no,no,nv,nv))
U = np.eye(nao*2)
print('\n#################### OCCD propagation ################')
td_occd_slow.kernel_rt_test(mf, t, l, U, w, f0, td, tf, step, RK=4, orb=True)
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='pauling049', release='3.10.0-327.36.3.el7.x86_64', version='#1 SMP Thu Oct 20 04:56:07 EDT 2016', machine='x86_64', processor='x86_64')  Threads 20
Python 3.7.4 (default, Aug 13 2019, 20:35:49) 
[GCC 7.3.0]
numpy 1.17.2  scipy 1.3.1
Date: Thu Sep  3 23:22:31 2020
PySCF version 1.7.1
PySCF path  /home/rppeng/code/pyscf/pyscf
GIT ORIG_HEAD 9324f3c4142ae713c70551f86b756a0d71fbddfd
GIT HEAD      ref: refs/heads/td-occd
GIT td-occd branch  7dd01cd0bf1e4f45ac0aa365c2721f1f2b737499

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 3
[INPUT] num. electrons = 10
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 O      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr
[INPUT]  2 H      1.000000000000   0.000000000000   0.000000000000 AA    1.889726124565   0.000000000000   0.000000000000 Bohr
[INPUT]  3 H     -0.577002178943   0.816742606636   0.000000000000 AA   -1.090376091479   1.543419840806   0.000000000000 Bohr

nuclear repulsion = 8.76480362344546
number of shells = 9
number of NR pGTOs = 30
number of NR cGTOs = 13
basis = 6-31g
ecp = {}
CPU time:         0.35


******** <class 'pyscf.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /tmp/tmp5sv9gelk
max_memory 4000 MB (current use 59 MB)
Set gradient conv threshold to 3.16228e-05
init E= -75.7375861111931
  HOMO = -0.463809532649705  LUMO = 0.0963392505092459
cycle= 1 E= -75.9388594964644  delta_E= -0.201  |g|= 0.417  |ddm|= 1.18
  HOMO = -0.395774830756782  LUMO = 0.201575455117767
cycle= 2 E= -75.9645850023343  delta_E= -0.0257  |g|= 0.236  |ddm|= 0.387
  HOMO = -0.488876580702086  LUMO = 0.186175569778295
cycle= 3 E= -75.9744510225455  delta_E= -0.00987  |g|= 0.0223  |ddm|= 0.145
  HOMO = -0.48586221492481  LUMO = 0.191236661082251
cycle= 4 E= -75.9746261523547  delta_E= -0.000175  |g|= 0.0032  |ddm|= 0.0236
  HOMO = -0.486708903557509  LUMO = 0.191091795519898
cycle= 5 E= -75.9746321248765  delta_E= -5.97e-06  |g|= 0.000424  |ddm|= 0.0058
  HOMO = -0.48688734200586  LUMO = 0.191082178802711
cycle= 6 E= -75.9746322569674  delta_E= -1.32e-07  |g|= 0.000104  |ddm|= 0.000953
  HOMO = -0.486911289544943  LUMO = 0.191089095970692
cycle= 7 E= -75.9746322671054  delta_E= -1.01e-08  |g|= 1.79e-05  |ddm|= 0.000315
  HOMO = -0.486911973217281  LUMO = 0.191091521065269
cycle= 8 E= -75.9746322673476  delta_E= -2.42e-10  |g|= 1.69e-06  |ddm|= 5.31e-05
  HOMO = -0.486912146292475  LUMO = 0.191091213399422
Extra cycle  E= -75.9746322673485  delta_E= -8.38e-13  |g|= 5.47e-07  |ddm|= 1.65e-06
converged SCF energy = -75.9746322673485

#################### FCI propagation ################
check initial energy: -75.97463226734857
time: 0.0000, EE(mH): 0.0
time: 0.0100, EE(mH): 0.1376984137806403
time: 0.0200, EE(mH): 0.275552590579764
time: 0.0300, EE(mH): 0.41356273766268714
time: 0.0400, EE(mH): 0.5517291089063292
time: 0.0500, EE(mH): 0.6900519041437292
time: 0.0600, EE(mH): 0.8285313677163231
time: 0.0700, EE(mH): 0.9671677085520969
time: 0.0800, EE(mH): 1.1059611629633537
time: 0.0900, EE(mH): 1.2449119612796267
time: 0.1000, EE(mH): 1.3840203143331564
time: 0.1100, EE(mH): 1.5232864782319666
time: 0.1200, EE(mH): 1.6627106481905685
time: 0.1300, EE(mH): 1.802293086640816
time: 0.1400, EE(mH): 1.942033985315561
time: 0.1500, EE(mH): 2.0819336167221536
time: 0.1600, EE(mH): 2.2219921652606445
time: 0.1700, EE(mH): 2.3622099108848715
time: 0.1800, EE(mH): 2.5025870410502193
time: 0.1900, EE(mH): 2.6431238153890035
time: 0.2000, EE(mH): 2.7838204524073262
time: 0.2100, EE(mH): 2.9246771959208218
time: 0.2200, EE(mH): 3.065694273828967
time: 0.2300, EE(mH): 3.2068719097537723
time: 0.2400, EE(mH): 3.34821036410915
time: 0.2500, EE(mH): 3.4897098421282635
time: 0.2600, EE(mH): 3.6313706086730235
time: 0.2700, EE(mH): 3.7731928686923766
time: 0.2800, EE(mH): 3.9151768924483576
time: 0.2900, EE(mH): 4.057322881521941
time: 0.3000, EE(mH): 4.199631108747326
time: 0.3100, EE(mH): 4.3421017819156305
time: 0.3200, EE(mH): 4.484735160701803
time: 0.3300, EE(mH): 4.627531469807877
time: 0.3400, EE(mH): 4.7704909587480415
time: 0.3500, EE(mH): 4.913613862328248
time: 0.3600, EE(mH): 5.0569004212093205
time: 0.3700, EE(mH): 5.200350886539695
time: 0.3800, EE(mH): 5.34396548124505
time: 0.3900, EE(mH): 5.4877444744079185
time: 0.4000, EE(mH): 5.631688074743124
time: 0.4100, EE(mH): 5.775796560499202
time: 0.4200, EE(mH): 5.920070147908518
time: 0.4300, EE(mH): 6.064509104746207
time: 0.4400, EE(mH): 6.20911365896859
time: 0.4500, EE(mH): 6.3538840636852
time: 0.4600, EE(mH): 6.4988205613190075
time: 0.4700, EE(mH): 6.643923400588392
time: 0.4800, EE(mH): 6.789192830751745
time: 0.4900, EE(mH): 6.934629096164713
time: 0.5000, EE(mH): 7.080232450292101
time: 0.5100, EE(mH): 7.226003131961534
time: 0.5200, EE(mH): 7.371941406091764
time: 0.5300, EE(mH): 7.518047507204528
time: 0.5400, EE(mH): 7.664321698186427
time: 0.5500, EE(mH): 7.81076422227045
time: 0.5600, EE(mH): 7.95737533805152
time: 0.5700, EE(mH): 8.104155288506831
time: 0.5800, EE(mH): 8.251104335528225
time: 0.5900, EE(mH): 8.398222722462378
time: 0.6000, EE(mH): 8.545510720367133
time: 0.6100, EE(mH): 8.69296856868118
time: 0.6200, EE(mH): 8.840596525971023
time: 0.6300, EE(mH): 8.988394850689474
time: 0.6400, EE(mH): 9.136363797921376
time: 0.6500, EE(mH): 9.284503628578022
time: 0.6600, EE(mH): 9.432814591662009
time: 0.6700, EE(mH): 9.581296954621621
time: 0.6800, EE(mH): 9.729950970225332
time: 0.6900, EE(mH): 9.878776899398645
time: 0.7000, EE(mH): 10.027775002143358
time: 0.7100, EE(mH): 10.176945538461268
time: 0.7200, EE(mH): 10.326288771523195
time: 0.7300, EE(mH): 10.475804962140955
time: 0.7400, EE(mH): 10.625494371979016
time: 0.7500, EE(mH): 10.775357263696606
time: 0.7600, EE(mH): 10.925393902383007
time: 0.7700, EE(mH): 11.07560454956058
time: 0.7800, EE(mH): 11.225989474269227
time: 0.7900, EE(mH): 11.376548938073938
time: 0.8000, EE(mH): 11.527283209730399
time: 0.8100, EE(mH): 11.67819255063307
time: 0.8200, EE(mH): 11.829277237680458
time: 0.8300, EE(mH): 11.980537528870627
time: 0.8400, EE(mH): 12.131973697336207
time: 0.8500, EE(mH): 12.283586015385595
time: 0.8600, EE(mH): 12.43537474420009
time: 0.8700, EE(mH): 12.587340162014016
time: 0.8800, EE(mH): 12.73948253496826
time: 0.8900, EE(mH): 12.891802138767616
time: 0.9000, EE(mH): 13.044299241073531
time: 0.9100, EE(mH): 13.196974118670823
time: 0.9200, EE(mH): 13.349827041750473
time: 0.9300, EE(mH): 13.502858288717334
time: 0.9400, EE(mH): 13.65606813011766
time: 0.9500, EE(mH): 13.809456846317403
time: 0.9600, EE(mH): 13.963024708473881
time: 0.9700, EE(mH): 14.116771995844601
time: 0.9800, EE(mH): 14.270698984660157
time: 0.9900, EE(mH): 14.424805957162334
time: 1.0000, EE(mH): 14.579093184451608
trace error:  [0. 0.]
Ehrenfest error:  [0. 0.]
imaginary part of energy:  1.0221961090288144e-14

#################### OCCD propagation ################
check initial energy: -75.9746322673486
time: 0.0000, EE(mH): 0.0, X: 5.472557052274808e-07
time: 0.0100, EE(mH): -3.6413240422916715e-05, X: 0.0025364166957310284
time: 0.0200, EE(mH): -5.590874252447975e-05, X: 0.005072105105349264
time: 0.0300, EE(mH): -4.681346865709202e-05, X: 0.007572253789732582
time: 0.0400, EE(mH): 6.579909950232832e-07, X: 0.010004431160825247
time: 0.0500, EE(mH): 9.356303110052977e-05, X: 0.012340334573620085
time: 0.0600, EE(mH): 0.00023569621987462597, X: 0.014557615281907656
time: 0.0700, EE(mH): 0.0004274109102198054, X: 0.016641513573533294
time: 0.0800, EE(mH): 0.0006658110152102381, X: 0.01858595691843391
time: 0.0900, EE(mH): 0.0009452884341953904, X: 0.020393848461202697
time: 0.1000, EE(mH): 0.001258345861288035, X: 0.022076480311987383
time: 0.1100, EE(mH): 0.0015966280386692233, X: 0.02365224805058496
time: 0.1200, EE(mH): 0.0019520653751214923, X: 0.025145001944741962
time: 0.1300, EE(mH): 0.00231803375072559, X: 0.026582373582338347
time: 0.1400, EE(mH): 0.0026904420593609757, X: 0.027994278656195932
time: 0.1500, EE(mH): 0.0030686710061900158, X: 0.029411610660271828
time: 0.1600, EE(mH): 0.003456307808846759, X: 0.030865016544076813
time: 0.1700, EE(mH): 0.0038616396409452136, X: 0.03238363921084344
time: 0.1800, EE(mH): 0.004297886107451632, X: 0.03399379465251678
time: 0.1900, EE(mH): 0.0047831663607667, X: 0.035717646971296514
time: 0.2000, EE(mH): 0.005340200999626177, X: 0.03757199475684079
time: 0.2100, EE(mH): 0.0059957536535648615, X: 0.03956728626251536
time: 0.2200, EE(mH): 0.006779817539381838, X: 0.041706972980940143
time: 0.2300, EE(mH): 0.007724558145127958, X: 0.04398730910790478
time: 0.2400, EE(mH): 0.008863028483574453, X: 0.04639768373524492
time: 0.2500, EE(mH): 0.010227698567177868, X: 0.04892149671103668
time: 0.2600, EE(mH): 0.011848859571728099, X: 0.05153746041380646
time: 0.2700, EE(mH): 0.013752996864013767, X: 0.05422108836229301
time: 0.2800, EE(mH): 0.015961246987217237, X: 0.05694609908417576
time: 0.2900, EE(mH): 0.01848807590931756, X: 0.05968556102872854
time: 0.3000, EE(mH): 0.02134031352341026, X: 0.062412794549384656
time: 0.3100, EE(mH): 0.024516672155527885, X: 0.06510222968473281
time: 0.3200, EE(mH): 0.028007844889543776, X: 0.06773048675988423
time: 0.3300, EE(mH): 0.03179724299684494, X: 0.0702778505926643
time: 0.3400, EE(mH): 0.035862376364548254, X: 0.07273008580662772
time: 0.3500, EE(mH): 0.04017683201595901, X: 0.07508029614100643
time: 0.3600, EE(mH): 0.044712745392416764, X: 0.07733038211110164
time: 0.3700, EE(mH): 0.049443614017263826, X: 0.07949166863095908
time: 0.3800, EE(mH): 0.054347261681186865, X: 0.08158444939732475
time: 0.3900, EE(mH): 0.05940873487020326, X: 0.08363645351785574
time: 0.4000, EE(mH): 0.0646229094058981, X: 0.08568048144572599
time: 0.4100, EE(mH): 0.06999658941708731, X: 0.08775160130235247
time: 0.4200, EE(mH): 0.07554991799452182, X: 0.08988431310384715
time: 0.4300, EE(mH): 0.08131696068858218, X: 0.09211000069169514
time: 0.4400, EE(mH): 0.08734538633348166, X: 0.09445485523094667
time: 0.4500, EE(mH): 0.09369524053681744, X: 0.09693832824167535
time: 0.4600, EE(mH): 0.10043687240113286, X: 0.09957209433652736
time: 0.4700, EE(mH): 0.10764814372521414, X: 0.1023594850080905
time: 0.4800, EE(mH): 0.1154110944128206, X: 0.10529538295625349
time: 0.4900, EE(mH): 0.12380827533320371, X: 0.10836661382015807
time: 0.5000, EE(mH): 0.13291897397493813, X: 0.11155290205469352
time: 0.5100, EE(mH): 0.14281555478135033, X: 0.11482843482122512
time: 0.5200, EE(mH): 0.1535601305988621, X: 0.11816398510191961
time: 0.5300, EE(mH): 0.16520175539369575, X: 0.12152940023387251
time: 0.5400, EE(mH): 0.17777430836929398, X: 0.12489611918326494
time: 0.5500, EE(mH): 0.19129520953242718, X: 0.12823931332032573
time: 0.5600, EE(mH): 0.20576507608893735, X: 0.13153930570070124
time: 0.5700, EE(mH): 0.22116839380714737, X: 0.1347821164305944
time: 0.5800, EE(mH): 0.23747523415806882, X: 0.1379592474414024
time: 0.5900, EE(mH): 0.25464399915620106, X: 0.1410670564013454
time: 0.6000, EE(mH): 0.2726251196065732, X: 0.14410617479685256
time: 0.6100, EE(mH): 0.2913655659710912, X: 0.14708134737389864
time: 0.6200, EE(mH): 0.3108139685821243, X: 0.1500018352133834
time: 0.6300, EE(mH): 0.33092607336016044, X: 0.15288222794984413
time: 0.6400, EE(mH): 0.35167020799065085, X: 0.1557432730112299
time: 0.6500, EE(mH): 0.3730323898309962, X: 0.1586122430675351
time: 0.6600, EE(mH): 0.3950206963736491, X: 0.1615224521716623
time: 0.6700, EE(mH): 0.4176685310000039, X: 0.1645117512788898
time: 0.6800, EE(mH): 0.4410364710452086, X: 0.1676200972074131
time: 0.6900, EE(mH): 0.4652124645474487, X: 0.17088650565517788
time: 0.7000, EE(mH): 0.49031025788792704, X: 0.17434581004733068
time: 0.7100, EE(mH): 0.5164660672534183, X: 0.17802564187137143
time: 0.7200, EE(mH): 0.5438336513918784, X: 0.1819439549464723
time: 0.7300, EE(mH): 0.5725780790442059, X: 0.18610728932774134
time: 0.7400, EE(mH): 0.6028686029964092, X: 0.19050986313772753
time: 0.7500, EE(mH): 0.6348711357304637, X: 0.19513352372317752
time: 0.7600, EE(mH): 0.6687408600356548, X: 0.19994858135591922
time: 0.7700, EE(mH): 0.7046154965877349, X: 0.20491555697649907
time: 0.7800, EE(mH): 0.7426096945266636, X: 0.20998785386198357
time: 0.7900, EE(mH): 0.7828109159930818, X: 0.2151152757812272
time: 0.8000, EE(mH): 0.8252770659993303, X: 0.22024815826016036
time: 0.8100, EE(mH): 0.8700359945663649, X: 0.22534169353147165
time: 0.8200, EE(mH): 0.9170868787293784, X: 0.23035988236145233
time: 0.8300, EE(mH): 0.9664033885030676, X: 0.23527850896603208
time: 0.8400, EE(mH): 1.0179384600803587, X: 0.24008665162403817
time: 0.8500, EE(mH): 1.0716304414302158, X: 0.24478650326959953
time: 0.8600, EE(mH): 1.1274103323444251, X: 0.24939162090093797
time: 0.8700, EE(mH): 1.1852098076019502, X: 0.25392405149777286
time: 0.8800, EE(mH): 1.2449696772023344, X: 0.2584109944397979
time: 0.8900, EE(mH): 1.3066484099226727, X: 0.2628816907920835
time: 0.9000, EE(mH): 1.3702302985620918, X: 0.26736507470440746
time: 0.9100, EE(mH): 1.435732817014923, X: 0.27188844196553097
time: 0.9200, EE(mH): 1.503212688135136, X: 0.27647708494887796
time: 0.9300, EE(mH): 1.5727701872663147, X: 0.2811546091011455
time: 0.9400, EE(mH): 1.6445512421512376, X: 0.2859435411072028
time: 0.9500, EE(mH): 1.7187469811403844, X: 0.29086586372304657
time: 0.9600, EE(mH): 1.7955905189381838, X: 0.2959432215517541
time: 0.9700, EE(mH): 1.8753509604465535, X: 0.3011966726796627
time: 0.9800, EE(mH): 1.9583248245282903, X: 0.30664596350116036
time: 0.9900, EE(mH): 2.044825323352484, X: 0.3123083614694248
time: 1.0000, EE(mH): 2.1351701591640904, X: 0.318197109979167
trace error:  [0. 0.]
Ehrenfest error:  9.899033794914142e-14
energy conservation error:  [0. 0.]
imaginary part of energy:  0.0
